<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alfie PTO Planner</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/favicon-32x32.png">
    
    <!-- External CSS Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.10/main.min.css" rel="stylesheet">
    
    <!-- External JavaScript Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.10/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Top Navigation Bar -->
    <nav class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <!-- Logo and Title -->
                <div class="flex items-center">
                    <img src="assets/alfie-icon.png" alt="Alfie Logo" class="h-8 w-8 mr-2">
                    <span class="text-xl font-semibold text-gray-900">Alfie PTO Planner</span>
                </div>
                
                <!-- Navigation Buttons -->
                <div class="flex items-center space-x-4">
                    <button id="newRequestBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">
                        Request Leave
                    </button>
                    <div class="relative" id="userMenu">
                        <button class="flex items-center space-x-2 text-gray-700">
                            <span>John Doe</span>
                            <img src="https://ui-avatars.com/api/?name=John+Doe" alt="Profile" class="h-8 w-8 rounded-full">
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <div class="max-w-7xl mx-auto py-6 px-4">
        <!-- Dashboard Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <!-- PTO Balance Card -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-medium mb-4">PTO Balance</h2>
                <div class="relative" style="height: 200px;">
                    <canvas id="ptoChart"></canvas>
                </div>
                <div class="grid grid-cols-3 gap-4 mt-4 text-center">
                    <div>
                        <span class="block text-sm text-gray-500">Vacation</span>
                        <span class="text-lg font-semibold text-indigo-600">15</span>
                    </div>
                    <div>
                        <span class="block text-sm text-gray-500">Sick</span>
                        <span class="text-lg font-semibold text-red-600">5</span>
                    </div>
                    <div>
                        <span class="block text-sm text-gray-500">Personal</span>
                        <span class="text-lg font-semibold text-green-600">3</span>
                    </div>
                </div>
            </div>

            <!-- Pending Requests Card -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-medium mb-4">Pending Requests</h2>
                <div class="space-y-3" id="pendingRequestsList">
                    <!-- Pending requests will be populated here -->
                </div>
            </div>

            <!-- Team Summary Card -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-medium mb-4">Team Summary</h2>
                <div class="space-y-3" id="teamSummaryList">
                    <!-- Team summary will be populated here -->
                </div>
            </div>
        </div>

        <!-- Calendar Section -->
        <div class="bg-white rounded-lg shadow p-6">
            <div id="calendar"></div>
        </div>
    </div>

    <!-- Leave Request Modal -->
    <div id="leaveRequestModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4">Request Leave</h3>
                <form id="leaveRequestForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700">Leave Type</label>
                        <select id="leaveType" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                            <option value="vacation">Vacation</option>
                            <option value="sick">Sick Leave</option>
                            <option value="personal">Personal</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700">Start Date</label>
                        <input type="date" id="startDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700">End Date</label>
                        <input type="date" id="endDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700">Description</label>
                        <textarea id="description" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="closeModal()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-md">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Initialize PTO Chart
        function initPTOChart() {
            const ctx = document.getElementById('ptoChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Vacation', 'Sick', 'Personal'],
                    datasets: [{
                        data: [15, 5, 3],
                        backgroundColor: [
                            '#4F46E5', // Indigo for Vacation
                            '#DC2626', // Red for Sick
                            '#059669'  // Green for Personal
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Initialize Calendar
        function initCalendar() {
            const calendarEl = document.getElementById('calendar');
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek'
                },
                events: loadEvents(),
                eventClick: function(info) {
                    showEventDetails(info.event);
                }
            });
            calendar.render();
            return calendar;
        }

        // Modal Functions
        function showModal() {
            document.getElementById('leaveRequestModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('leaveRequestModal').classList.add('hidden');
        }

        // Load events from localStorage
        function loadEvents() {
            const storedEvents = localStorage.getItem('ptoEvents');
            return storedEvents ? JSON.parse(storedEvents) : [];
        }

        // Save event to localStorage
        function saveEvent(event) {
            const events = loadEvents();
            events.push(event);
            localStorage.setItem('ptoEvents', JSON.stringify(events));
        }

        // Show event details using SweetAlert
        function showEventDetails(event) {
            Swal.fire({
                title: event.title,
                html: `
                    <p><strong>Start:</strong> ${event.start.toLocaleDateString()}</p>
                    <p><strong>End:</strong> ${event.end ? event.end.toLocaleDateString() : event.start.toLocaleDateString()}</p>
                    <p><strong>Status:</strong> ${event.extendedProps.status || 'Pending'}</p>
                `,
                icon: 'info'
            });
        }

        // Initialize everything when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Chart
            initPTOChart();

            // Initialize Calendar
            const calendar = initCalendar();

            // Setup event listeners
            document.getElementById('newRequestBtn').addEventListener('click', showModal);

            // Handle form submission
            document.getElementById('leaveRequestForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const event = {
                    title: document.getElementById('leaveType').value,
                    start: document.getElementById('startDate').value,
                    end: document.getElementById('endDate').value,
                    description: document.getElementById('description').value,
                    backgroundColor: getEventColor(document.getElementById('leaveType').value)
                };

                calendar.addEvent(event);
                saveEvent(event);
                closeModal();
                
                Swal.fire({
                    title: 'Success!',
                    text: 'Your leave request has been submitted.',
                    icon: 'success'
                });
            });
        });

        // Helper function to get event colors
        function getEventColor(leaveType) {
            const colors = {
                'vacation': '#4F46E5',
                'sick': '#DC2626',
                'personal': '#059669'
            };
            return colors[leaveType] || '#4F46E5';
        }
    </script>
</body>
</html>
