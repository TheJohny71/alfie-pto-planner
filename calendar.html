<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PTO Calendar</title>
    <!-- Keep your existing stylesheets -->
    <link rel="stylesheet" href="styles/calendar.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/modern-theme.css">
    <!-- Add new modal styles -->
    <style>
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            z-index: 1001;
            max-width: 500px;
            width: 90%;
        }

        .slide-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100%;
            background: white;
            padding: 20px;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 999;
        }

        .slide-panel.open {
            right: 0;
        }
    </style>
</head>
<body>
    <div class="calendar-container">
        <header class="header">
            <h1 class="title">PTO Calendar</h1>
            <select class="region-select" id="regionSelect">
                <option value="US">United States</option>
                <option value="UK">United Kingdom</option>
            </select>
        </header>

        <div class="controls">
            <button id="prevMonth">&larr; Previous</button>
            <h2 id="currentMonth">January 2024</h2>
            <button id="nextMonth">Next &rarr;</button>
        </div>

        <div class="calendar" id="calendar">
            <!-- Calendar grid will be populated by JavaScript -->
        </div>
    </div>

    <div class="pto-form">
        <h3>Add PTO Days</h3>
        <form id="ptoForm">
            <div class="form-group">
                <label for="ptoStart">Start Date:</label>
                <input type="date" id="ptoStart" required>
            </div>
            <div class="form-group">
                <label for="ptoEnd">End Date:</label>
                <input type="date" id="ptoEnd" required>
            </div>
            <div class="form-group">
                <label for="ptoType">Type:</label>
                <select id="ptoType">
                    <option value="vacation">Vacation</option>
                    <option value="sick">Sick Leave</option>
                    <option value="personal">Personal Day</option>
                </select>
            </div>
            <button type="submit" class="export-button">Add PTO</button>
        </form>
        <button id="exportButton" class="export-button">Export Schedule</button>
    </div>
    <script>
        class Calendar {
            constructor() {
                this.currentDate = new Date();
                this.selectedDate = null;
                this.region = 'US';
                this.ptoDays = new Set();
                this.ptoDetails = new Map(); // Store PTO details for export
                
                this.initializeElements();
                this.addEventListeners();
                this.render();
            }

            initializeElements() {
                this.calendarElement = document.getElementById('calendar');
                this.regionSelect = document.getElementById('regionSelect');
                this.currentMonthElement = document.getElementById('currentMonth');
                this.prevMonthButton = document.getElementById('prevMonth');
                this.nextMonthButton = document.getElementById('nextMonth');
                this.ptoForm = document.getElementById('ptoForm');
                this.exportButton = document.getElementById('exportButton');
            }

            addEventListeners() {
                this.prevMonthButton.addEventListener('click', () => this.previousMonth());
                this.nextMonthButton.addEventListener('click', () => this.nextMonth());
                this.regionSelect.addEventListener('change', (e) => {
                    this.region = e.target.value;
                    this.render();
                });
                
                // PTO form submission
                this.ptoForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addPTODays();
                });

                // Export functionality
                this.exportButton.addEventListener('click', () => this.exportSchedule());
            }
            addPTODays() {
                const startDate = new Date(document.getElementById('ptoStart').value);
                const endDate = new Date(document.getElementById('ptoEnd').value);
                const ptoType = document.getElementById('ptoType').value;

                let currentDate = new Date(startDate);
                while (currentDate <= endDate) {
                    // Skip weekends
                    if (currentDate.getDay() !== 0 && currentDate.getDay() !== 6) {
                        const dateString = this.formatDate(currentDate);
                        this.ptoDays.add(dateString);
                        this.ptoDetails.set(dateString, {
                            type: ptoType,
                            date: new Date(currentDate)
                        });
                    }
                    currentDate.setDate(currentDate.getDate() + 1);
                }

                this.render();
                this.ptoForm.reset();
            }

            exportSchedule() {
                const schedule = {
                    ptoDays: [],
                    holidays: this.getHolidaysForYear(this.currentDate.getFullYear())
                };

                // Convert PTO details to array
                this.ptoDetails.forEach((details, date) => {
                    schedule.ptoDays.push({
                        date: date,
                        type: details.type
                    });
                });

                // Create and download file
                const blob = new Blob([JSON.stringify(schedule, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'pto-schedule.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            getHolidaysForYear(year) {
                const holidays = {
                    US: {},
                    UK: {}
                };

                // US Holidays
                holidays.US[`${year}-01-01`] = "New Year's Day";
                holidays.US[`${year}-01-${this.getNthDayOfMonth(year, 0, 3, 1)}`] = "Martin Luther King Jr. Day"; // 3rd Monday of January
                holidays.US[`${year}-02-${this.getNthDayOfMonth(year, 1, 3, 1)}`] = "Presidents Day"; // 3rd Monday of February
                holidays.US[`${year}-05-${this.getLastDayOfMonth(year, 4, 1)}`] = "Memorial Day"; // Last Monday of May
                holidays.US[`${year}-07-04`] = "Independence Day";
                holidays.US[`${year}-09-${this.getNthDayOfMonth(year, 8, 1, 1)}`] = "Labor Day"; // 1st Monday of September
                holidays.US[`${year}-11-${this.getNthDayOfMonth(year, 10, 4, 4)}`] = "Thanksgiving Day"; // 4th Thursday of November
                holidays.US[`${year}-12-25`] = "Christmas Day";

                // UK Holidays
                holidays.UK[`${year}-01-01`] = "New Year's Day";
                holidays.UK[`${year}-05-${this.getNthDayOfMonth(year, 4, 1, 1)}`] = "Early May Bank Holiday";
                holidays.UK[`${year}-05-${this.getLastDayOfMonth(year, 4, 1)}`] = "Spring Bank Holiday";
                holidays.UK[`${year}-08-${this.getLastDayOfMonth(year, 7, 1)}`] = "Summer Bank Holiday";
                holidays.UK[`${year}-12-25`] = "Christmas Day";
                holidays.UK[`${year}-12-26`] = "Boxing Day";

                return holidays;
            }

            getNthDayOfMonth(year, month, nth, dayOfWeek) {
                let date = new Date(year, month, 1);
                let count = 0;
                
                while (count < nth) {
                    if (date.getDay() === dayOfWeek) {
                        count++;
                    }
                    if (count < nth) {
                        date.setDate(date.getDate() + 1);
                    }
                }
                
                return date.getDate();
            }

            getLastDayOfMonth(year, month, dayOfWeek) {
                let date = new Date(year, month + 1, 0);
                
                while (date.getDay() !== dayOfWeek) {
                    date.setDate(date.getDate() - 1);
                }
                
                return date.getDate();
            }

            formatDate(date) {
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            }

            isHoliday(date) {
                const formattedDate = this.formatDate(date);
                const yearHolidays = this.getHolidaysForYear(date.getFullYear());
                return yearHolidays[this.region][formattedDate];
            }

            previousMonth() {
                this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                this.render();
            }

            nextMonth() {
                this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                this.render();
            }
            render() {
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();
                
                // Update month display
                const monthName = new Date(year, month).toLocaleString('default', { month: 'long' });
                this.currentMonthElement.textContent = `${monthName} ${year}`;

                // Clear calendar
                this.calendarElement.innerHTML = '';

                // Add weekday headers
                const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                weekdays.forEach(day => {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'weekday';
                    dayElement.textContent = day;
                    this.calendarElement.appendChild(dayElement);
                });

                // Get first day of month and number of days
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                // Add empty cells for days before start of month
                for (let i = 0; i < firstDay; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'day';
                    this.calendarElement.appendChild(emptyDay);
                }

                // Add days of month
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, month, day);
                    const dayElement = document.createElement('div');
                    dayElement.className = 'day';
                    
                    const dateSpan = document.createElement('span');
                    dateSpan.className = 'date';
                    dateSpan.textContent = day;
                    dayElement.appendChild(dateSpan);

                    const formattedDate = this.formatDate(date);
                    
                    // Check for PTO
                    if (this.ptoDays.has(formattedDate)) {
                        dayElement.classList.add('pto');
                        const ptoDetail = this.ptoDetails.get(formattedDate);
                        const indicator = document.createElement('span');
                        indicator.className = 'indicator';
                        indicator.textContent = ptoDetail.type;
                        dayElement.appendChild(indicator);
                    }

                    // Check for holidays
                    const holidayName = this.isHoliday(date);
                    if (holidayName) {
                        dayElement.classList.add('holiday');
                        const indicator = document.createElement('span');
                        indicator.className = 'indicator';
                        indicator.textContent = holidayName;
                        dayElement.appendChild(indicator);
                    }

                    dayElement.addEventListener('click', () => {
                        const selected = this.calendarElement.querySelector('.selected');
                        if (selected) selected.classList.remove('selected');
                        dayElement.classList.add('selected');
                        this.selectedDate = date;
                    });

                    this.calendarElement.appendChild(dayElement);
                }
            }
        }

        // Initialize calendar when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new Calendar();
        });
    </script>
</body>
</html>
